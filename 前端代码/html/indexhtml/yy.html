<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="../../images/favicon.ico" type="image/x-icon">
    <title>医院信息</title>
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/hospitalHead.css">
    <link rel="stylesheet" href="../../css/yy.css">
    <script src="../../jQuery/jQuery.min.js"></script>
    <script src="../../jQuery/dist/jquery.validate.min.js"></script>
    <script src="../../jQuery/dist/localization/messages_zh.js"></script>
    <script src="../../bootstrap/js/bootstrap.min.js"></script>
    <script src="../../js/cookie.js"></script>
    <style></style>
</head>

<body>
    <div>
        <div class="header"></div>
        <div class="yycenter clearfix">
            <ul id="myTab" class="nav nav-tabs">
                <li class="active">
                    <a href="#appoint" data-toggle="tab">预约挂号</a>
                </li>
                <li>
                    <a href="#info" data-toggle="tab">医院介绍</a>
                </li>
                <li>
                    <a href="#notice" data-toggle="tab">预约须知</a>
                </li>
                <li>
                    <a href="#tz" data-toggle="tab">停诊信息</a>
                </li>
                <li><a onclick="jumpAyygh()" id="reselect">选择其它医院</a></li>
            </ul>
            <div id="myTabContent2" class="tab-content">
                <div class="tab-pane fade in active" id="appoint">
                    <div class="hospitalHead"></div>
                    <div class="open-depart">
                        <span id="mzpbb"></span>
                        <a id="rtHos">返回科室列表</a>
                        <table id="tb1">
                            <tr id="time">
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>
                    </div>
                    <div class="rule">
                        <div class="rule-t">
                            <span>预约规则</span>
                            <span>(每天8:00更新)</span>
                        </div>
                        <div class="rule-b">
                            <p>预约周期:7天</p>
                            <p>放号时间:8:00</p>
                            <p>停挂时间:14:00:00</p>
                            <p>退挂时间:就诊前一工作日14:00前取消</p>
                            <p>特殊规则:① 取号地点不同：西院区预约号取号地点：西院区门诊楼一层大厅挂号窗口取号。
                                东院区预约号取号地点：东院区老门诊楼一层大厅挂号窗口或新门诊楼各楼层挂号/收费窗口取号。</p>
                        </div>
                    </div>
                    <div id="docInfo"></div>
                </div>
                <div class="tab-pane fade" id="info">
                    <div class="hospitalHead"></div>
                    <div class="introduce">
                        <div class="intr-h">
                            <p>医院介绍</p>
                        </div>
                        <div class="intr-content">
                            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;该医院是集医疗、教学、科研于一体的大型三级甲等综合医院，
                                是国家卫生计生委指定的全国疑难重症诊治指导中心，也是最早承担高干保健和外宾医疗任务的医院之一，以学科齐全、技术力
                                量雄厚、特色专科突出、多学科综合优势强大享誉海内外。在2010、2011、2012、2013、2014年复旦大学医院管理研究所公布
                                的“中国最佳医院排行榜”中连续五年名列榜首。</p>
                            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;医院建成于1921年，由洛克菲勒基金会创办。建院之初，就志在“建
                                成亚洲最好的医学中心”。90余年来，医院形成了“严谨、求精、勤奋、奉献”的协和精神和兼容并蓄的特色文化风格，创立了“三
                                基”、“三严”的现代医学教育理念，形成了以“教授、病案、图书馆”著称的协和“三宝”，培养造就了张孝骞、林巧稚等一代医学大
                                师和多位中国现代医学的领军人物，并向全国输送了大批的医学管理人才，创建了当今知名的10余家大型综合及专科医院。2011
                                年在总结90年发展经验的基础上，创新性提出了“待病人如亲人，提高病人满意度；待同事如家人，提高员工幸福感”新办院理念。
                            </p>
                            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目前，医院共有2个院区、总建筑面积53万平方米，在职职工4000余名
                                、两院院士5人、临床和医技科室53个、国家级重点学科20个、国家临床重点专科29个、博士点16个、硕士点29个、国家级继续
                                医学教育基地6个、二级学科住院医师培养基地18个、三级学科专科医师培养基地15个。开放住院床位2000余张，单日最高门诊
                                量约1.5万人次、年出院病人约8万余人次。被评为“全国文明单位”、“全国创先争优先进基层党组织”、“全国卫生系统先进集体”
                                、“首都卫生系统文明单位”、“最受欢迎三甲医院”，荣获全国五一劳动奖章。同时，医院还承担着支援老少边穷地区、国家重要
                                活动和突发事件主力医疗队的重任，在2008年北京奥运工作中荣获“特别贡献奖”。</p>
                            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;90多年来，协和人以执着的医志、高尚的医德、精湛的医术和严
                                谨的学风书写了辉煌的历史，今天的协和人正为打造“国际知名、国内一流”医院的目标而继续努力。</p>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="notice">
                    <div class="hospitalHead"></div>
                    <div class="introduce">
                        <div class="intr-h">
                            <p>预约须知</p>
                        </div>
                        <div class="intr-content">
                            <h4>医院预约挂号须知</h4>
                            <p><strong>电话预约挂号：010-114（24小时）<br>
                                    网络预约挂号：http://127.0.0.1:5500/html/indexhtml/index.html
                                </strong></p>
                            <p> 根据卫生部8月5日通知和卫生局8月20日工作部署，北京协和医院已完成电话、网络预约挂号的流程建设，
                                现将预约挂号、取号有关事项公布如下，请您认真阅读预约须知：</p>
                            <strong>一、预约时间范围：</strong><br>
                            <p> 1、您可预约7天内（试点）日间的副教授、主治医师和住院医师等号源。节假日不安排预约号（含周六、周日）。</p>
                            <p> 2、每天早8:30分开始放号;下午14:00停止次日预约挂号。</p>
                            <p> 3、周五14:00停挂至下周一。</p>
                            <strong>二、预约实名制：</strong>
                            <p>统一平台电话预约和网上预约挂号均采取实名制注册预约，请您如实提供就诊人员的真实姓名、有效
                                证件号、性别、电话、手机号码、病案号或协和就诊卡条形码上的ID号等有效基本信息。</p>
                            <strong>三、预约取号：</strong>
                            <p> 1、预约成功后，请患者于就诊当日携带有效证件、预约识别码及协和医院就诊卡到医院挂号窗口验
                                证预约信息（核对与预约登记实名信息一致的本人有效证件和预约识别码）和取号，如验证不符则医
                                院不能提供相应的诊疗服务。如果没有协和医院就诊卡者，请先办好就诊卡后再取号。</p>
                            <p> 2、取号时间：上午就诊患者，就诊当日早9：00以前取号。下午就诊患者，就诊当日下午
                                12:00-13:30之间取号。过时未取号者，预约作废。</p>
                            <p> 3、取号地点：西院区预约号取号地点：西院区门诊楼一层大厅挂号窗口取号。东院区预约号取
                                号地点：东院区老门诊楼一层大厅挂号窗口或新门诊楼各楼层挂号/收费窗口取号。</p>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tz">
                    <div class="hospitalHead"></div>
                    <div class="introduce">
                        <div class="intr-h">
                            <p>停诊信息</p>
                        </div>
                        <div class="intr-content">
                            <h4>停诊信息</h4>
                            <table>
                                <tr>
                                    <td>日期</td>
                                    <td>星期</td>
                                    <td>时段</td>
                                    <td>科室</td>
                                    <td>特长</td>
                                    <td>职称</td>
                                    <td>可挂号数</td>
                                    <td>剩余号数</td>
                                </tr>
                                <tr>
                                    <td>2019-05-08</td>
                                    <td>3</td>
                                    <td>下午</td>
                                    <td>基本外科门诊</td>
                                    <td></td>
                                    <td>知名专家</td>
                                    <td>0</td>
                                    <td>0</td>
                                </tr>
                                <tr>
                                    <td>2019-05-07</td>
                                    <td>2</td>
                                    <td>上午</td>
                                    <td>基本外科门诊</td>
                                    <td></td>
                                    <td>知名专家</td>
                                    <td>0</td>
                                    <td>0</td>
                                </tr>
                                <tr>
                                    <td>2019-05-06</td>
                                    <td>1</td>
                                    <td>上午</td>
                                    <td>心外科门诊</td>
                                    <td></td>
                                    <td>副教授</td>
                                    <td>3</td>
                                    <td>3</td>
                                </tr>
                                <tr>
                                    <td>2019-05-06</td>
                                    <td>1</td>
                                    <td>下午</td>
                                    <td>心外科门诊</td>
                                    <td></td>
                                    <td>副教授</td>
                                    <td>3</td>
                                    <td>3</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer"></div>
    </div>

    <script>
        $(document).ready(function () {
            $(".header").load("../indexhtml/header.html");
            $(".footer").load("../indexhtml/footer.html");
        });

        //点击选择其它医院跳转至按医院挂号界面
        function jumpAyygh() {
            window.location.href = "./ayygh.html";
        }

        window.onload = function () {
            let paras = location.search;			//search获得地址中的参数,内容为'?id='
            let result = paras.match(/[^\?&]*=[^&]*/g); 	//match是字符串中符合的字段一个一个取出来
            paras = {};					//让paras变成没有内容的json对象
            for (i in result) {
                let temp = result[i].split('=');	//split()将一个字符串分解成一个数组,两次遍历result中的值分别为['id','xx']
                paras[temp[0]] = temp[1];
            }
            console.log(paras)
            let hosId = paras.hosId,
                depId = paras.depId,
                depName = paras.depName;
            getAjax("http://localhost:8080/selectHospital?hospitalId=" + hosId, showHospital);
            getAjax("http://localhost:8080/selectByDepartment?id=" + depId, showArrange);
            getAjax("http://localhost:8080/selectDepartmentAllInfo?departmentId=" + depId, getDepName);
            // console.log(id)

            //显示医院信息
            function showHospital(data) {
                let hospitalList = data.hospitalList;
                for (let i in hospitalList) {
                    let dir = "../../images/" + hospitalList[i].imgUrl;
                    let dir2 = "../../images/staticimage" + hosId + ".png";
                    let div = "<strong>" + hospitalList[i].hospitalName + "</strong>" +
                        "<a class='attention' href='#'>关注医院</a>" +
                        "<span class='r-top right'>" + hospitalList[i].classify + "</span>" +
                        "<span class='r-top blue'>分类:" + "</span>" +
                        "<span class='r-top right'>" + hospitalList[i].area + "</span>" +
                        "<span class='r-top blue'>地区:" + "</span>" +
                        "<span class='r-top right'>" + hospitalList[i].level + "</span>" +
                        "<span class='r-top blue'>等级:" + "</span>" + "<hr>" +
                        `<img src=${dir} width='200' height='150'></img>` +
                        "<div class='allp'><p class='address'>" + hospitalList[i].address + "</p>" +
                        "<p class='url'>" + hospitalList[i].url + "</p>" +
                        "<p class='phone'>" + hospitalList[i].phone + "</p>" +
                        "<p class='route'>" + hospitalList[i].route + "</p></div>" +
                        `<img src=${dir2} width='250' height='212' id='map'>`;
                    $(".hospitalHead").append("<div>" + div + "</div>");
                }
            }

            //显示排班信息
            function showArrange(data) {
                let planLst = data.intervalPlanLstList;
                console.log(planLst)
                for (let i in planLst) {
                    let tr = "<tr class='tr'>"
                    for (let j in planLst[i]) {
                        let str = planLst[i][j] + '';
                        // console.log(str)
                        if (str.indexOf('-') != -1 && j > 0) {
                            tr = tr + `<td onclick='showDoctorInfo(${str.split('-')[0]},${depId},${j})' class='addStyle'>` + str.split('-')[1] + "</td>";
                            // tr = tr + `<td onclick='plan(${str.split('-')[0]},${hosId},${depId},${j})' class='addStyle'>` + str.split('-')[1] + "</td>";
                        } else if (str.indexOf('已约满') != -1) {
                            tr = tr + "<td class='addStyle2'>" + str + "</td>";
                        } else {
                            tr = tr + "<td>" + str + "</td>";
                        }
                    }
                    tr = tr + "</tr>";
                    $("#tb1").append(tr);
                }
            }

            //获取科室名称,得到科室排班表名称
            function getDepName(data) {
                console.log(data.departmentInfo[0].departmentName)
                $('#mzpbb')[0].innerHTML = data.departmentInfo[0].departmentName + '排班表';
            }

            //点击排班表中可预约时段显示医生信息
            window.showDoctorInfo = function (str,depId,j) {
                console.log("str:"+ str)
                console.log("j:"+ j)
                $("#docInfo").css('display', 'block');
                getAjax("http://localhost:8080/selectDoctor?departmentId=" + depId, getDoctorInfo);

                function getDoctorInfo(data) {
                    $("#docInfo")[0].innerHTML = '';
                    console.log(data)
                    let doctorList = data.doctorList;
                    for (let i in doctorList) {
                        // let src = "../../images/tx_doctor.png";
                        // let div = `<img src=${src} width='256' height='256'></img>` +
                        //     `<div class='right'><p><span>主治医生&nbsp;&nbsp;${doctorList[i].realName}</span>
                        //     <span>医事服务费:￥50</span></p>` +
                        //     `<p><span>${doctorList[i].post}</span></p>` +
                        //     `<p>联系电话:${doctorList[i].phoneNumber}</p></div>` +
                        //     `<button onclick="plan(${str},${hosId},${depId},${j},\'${doctorList[i].realName}\')">预约</button>`;
                        // $("#docInfo").append("<div>" + div + "</div>");
                        let src = "../../images/tx_doctor.png";
                        let div = `<img src=${src} width='256' height='256'></img>` +
                            `<div class='right'><p><span>${doctorList[i].realName}</span>
                            <span>医事服务费:￥50</span></p>` +
                            `<p><span>${doctorList[i].post}</span></p>` +
                            `<p>联系电话:${doctorList[i].phoneNumber}</p></div>` +
                            `<button onclick="plan(${str},${hosId},${depId},${j},\'${doctorList[i].realName}\')">预约</button>`;
                        $("#docInfo").append("<div><h3>推荐医生</h3>" + div + "</div>");
                    }
                }
            }

            //点击预约按钮时跳转
            window.plan = function (planId, hosId, depId, d,doctorName) {
                if (!sessionStorage.userId) {
                    alert("请先登录")
                } else {
                    console.log(planId, doctorName)
                    window.location.href = './yyInfo.html?planId=' + planId + '&hosId=' + hosId + 
                    "&depId=" + depId + "&day=" + d + '&doctorName=' + doctorName;
                }
            }

            //生成排班表表头
            let date = new Date(),
                y = date.getFullYear(),
                m = date.getMonth() + 1,
                d = date.getDate(),
                a = new Array("日", "一", "二", "三", "四", "五", "六"),
                week = date.getDay();
            if (m > 0 && m < 10) {         //月份格式化
                m = "0" + m;
            }
            let time = y + "-" + m + "-";
            let td = document.getElementById("time").getElementsByTagName("td");
            // console.log(td)
            for (let k in td) {
                if (k == 0) {
                    continue
                }
                d = parseInt(d) + 1;       //日期中天数+1
                week = (week + 1) % 7;     //当前天数的getDay()
                if (d >= 0 && d < 10) {    //天数格式化
                    d = "0" + d;
                }
                td[k].innerHTML = time + d + "星期" + a[week];
            }

            $("#rtHos").on('click', function () {
                window.location.href = "./hospital.html?hosId=" + hosId;
            });

        }

        function getAjax(url, func) {
            $.ajax({
                type: "GET",
                url: url,
                dataType: "json",
                success: function (data) {
                    func(data);
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }
    </script>
</body>

</html>